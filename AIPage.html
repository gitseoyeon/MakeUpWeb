<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>chatGPT API</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        /* page-loading */
        #loading {
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            position: fixed;
            display: block;
            opacity: 0.6;
            background: #e4e4e4;
            z-index: 99;
            text-align: center;
        }

        #loading>img {
            position: absolute;
            top: 40%;
            left: 45%;
            z-index: 100;
        }

        #loading>p {
            position: absolute;
            top: 57%;
            left: 43%;
            z-index: 101;
        }
    </style>
</head>

<body>
<h1>chatGPT API</h1>
<div>무엇이든 질문해보세요 !!</div>

<label for="cosmeticType">추천받고 싶은 화장품 종류는</label>
<input type="text" id="cosmeticType" required />

<label for="favoriteColor">내가 선호하는 컬러는</label>
<input type="text" id="favoriteColor" required />

<label for="dislikedColor">내가 비선호하는 컬러는</label>
<input type="text" id="dislikedColor" required />

<label for="favoriteTexture">내가 좋아하는 텍스쳐는</label>
<input type="text" id="favoriteTexture" required />

<button onclick="chatGPT()">입력</button>
<div id="result"></div>

<div id="loading">
    <img src="https://studentrights.sen.go.kr/images/common/loading.gif">
</div>
<script>
    $(document).ready(function () {
        $('#loading').hide();
    });

    function chatGPT() {
        const api_key = "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";  // <- API KEY 입력
        const cosmeticType = document.getElementById('cosmeticType').value;
        const favoriteColor = document.getElementById('favoriteColor').value;
        const dislikedColor = document.getElementById('dislikedColor').value;
        const favoriteTexture = document.getElementById('favoriteTexture').value;
        $('#loading').show();

        const messages = [
            { role: 'system', content: 'You are a helpful assistant.' },
            {
                role: 'user',
                content: `화장품을 추천받고 싶어. 추천받고 싶은 화장품 종류는 ${cosmeticType} 야.
                                내가 선호하는 컬러는 ${favoriteColor}고, 비선호하는 컬러는 ${dislikedColor}야.
                                ${favoriteTexture} 같은 텍스쳐였으면 좋겠어. 몇 개 추천해줄 수 있니?`
            },
        ];

        const data = {
            model: 'gpt-3.5-turbo',
            temperature: 0.5,
            n: 1,
            messages: messages,
        };

        $.ajax({
            url: "https://api.openai.com/v1/chat/completions",
            method: 'POST',
            headers: {
                Authorization: "Bearer " + api_key,
                'Content-Type': 'application/json',
            },
            data: JSON.stringify(data),
        }).then(function (response) {
            $('#loading').hide();
            console.log(response);
            let result = document.getElementById('result');
            let pre = document.createElement('pre');
            pre.innerHTML = "\n\n" + response.choices[0].message.content;
            result.appendChild(pre);
        });
    }
</script>
</body>

</html>
